\appendix
\clearpage
\addappheadtotoc
\appendixpage

\section{Instalación y Ejecución de Arco Iris y Arco Iris UI}
\label{sec:instalacionYEjecucionArcoIris}

	\subsection{Aclaración importante}

		En el DVD que acompaña al presente trabajo, se incluye la totalidad de las herramientas necesarias para visualizar el
		código fuente de Rainbow, Arco Iris y Arco Iris UI; así también como los sendos códigos fuentes de las tres
		aplicaciones. De cualquier manera, describiremos brevemente los requisitos y pasos necesarios para que cualquier
		persona interesada pueda instalar y ejecutar las aplicaciones objeto de este trabajo.

	\subsection{Prerrequisitos}

		\subsubsection{Sólo para Ejecución}
			\noindent \textbf{Java 6.0 o superior}

			Tanto Rainbow como Arco Iris y Arco Iris UI son aplicaciones Java que necesitan de una máquina virtual Java instalada
			en la computadora dónde se desee ejecutar estas aplicaciones. La misma se encuentra disponible para la gran
			mayoría de las plataformas utilizadas comúnmente (Windows, Unix, Solaris, MAC OS, etc.) y puede ser descargada
			gratuitamente desde \url{http://www.oracle.com/technetwork/java/javase/downloads/index.html}.
			
		\subsubsection{Para Inspección y Edición del Código Fuente}

			\noindent \textbf{Eclipse 3.6 o superior}
			En el caso en que se desee inspeccionar o editar el código fuente de Rainbow, Arco Iris y/o Arco Iris UI, una
			herramienta no imprescindible aunque muy recomendada es \textbf{Eclipse}. Eclipse es un entorno de desarrollo
			integrado que permite visualizar, editar, compilar y ejecutar (entre otras muchas cosas) aplicaciones Java. Se
			descarga gratuitamente desde \url{http://www.eclipse.org/downloads/} y la versión ``for Java Developers'' es
			suficiente a los fines de trabajar con las aplicaciones que conciernen a este trabajo.
			
			El código fuente incluído incluye metadata de Eclipse, con lo cual, si se utilizan los correspondientes
			\emph{plugins} detallados a configuración, debería ser relativamente sencillo poder disponer rápidamente de todos
			los proyectos que conforman el tandem Rainbow-Arco Iris. los plugins de Eclipse requeridos son:

			\begin{itemize}
				\item \textbf{Maven plugin}: El plugin para Eclipse de Maven. El mismo puede ser obtenido utilizando el
				\emph{Marketplace} de Eclipse o utilizando la siguiente URI \url{http://m2eclipse.sonatype.org/sites/m2e}.
				\item \textbf{Subclipse}: Se trata del plugin para Eclipse que provee soporte para interactuar con repositorios
				Subversion\footnote{Para más información sobre Subversion, visitar \url{http://subversion.tigris.org/}}. Tanto
				el código de Rainbow como el de Arco Iris se encuentran alojados en servidores Subversion (SVN).
			\end{itemize} 

			\noindent \textbf{Maven 2 o superior}
			A fin de compilar y empaquetar el código fuente de la aplicación mediante la línea de comandos del sistema operativo,
			es necesario utilizar Maven, la popular herramienta de construcción de aplicaciones Java. Maven es una
			herramienta multi plataforma con una abundante cantidad de documentación de calidad, la cual puede ser consultada
			visitando su página web: \url{http://maven.apache.org/}, desde la cual se puede descargar también la aplicación.

	\subsection{Obtención del código fuente de Rainbow, Arco Iris y Arco Iris UI}
	
		El grupo ABLE posee un repositorio SVN privado, el cuál es sólo accesible mediante el otorgamiento de un usuario
		(normalmente de sólo lectura) y contraseña; a pedido explícito del interesado. A fin de obtener dichas credenciales de
		acceso, es necesario redactar un e-mail a David Garlan $<$\url{garlan@cs.cmu.edu}$>$.
		
		El código fuente de Arco Iris y Arco Iris UI (junto con algunas pequeñas modificaciones realizadas al código de
		Rainbow) se encuentra alojado en Google Code, en la siguiente URI: \url{http://code.google.com/p/arco-iris}. Ambas
		aplicaciones creadas a instancias del presente trabajo, son de código abierto (\emph{open source}), esto significa que
		cualquier persona puede acceder libremente al código fuente y examinarlo.

	\subsection{Compilación de Arco Iris y Arco Iris UI}
	
		\todo{Explicar que hay un reactor pom, que incluye a JFaceGUI (mencionar brevemente qué es), que el proyecto
		arco-iris-core tiene las dependencias de rainbow cocinadas, explicar la detección del SO que hace JFaceGUI, etc\ldots}

	\subsection{Ejecución de las aplicaciones}

		\todo{Explicar ejemplos de como se ejecutan ambas aplicaciones}

\section{Arquitectura de Znn modelada con Acme}
\label{sec:arquitecturaZNN}

	\begin{Verbatim}
		import TargetEnvType.acme;
	
		Family ZNewsFam extends EnvType with {
	
			Port Type HttpPortT extends ArchPortT with {
	
			}
			Role Type RequestorRoleT extends ArchRoleT with {

			}
			Component Type ProxyT extends ArchElementT with {

				Property deploymentLocation : string <<  default : string = "localhost"; >> ;

				Property load : float <<  default : float = 0.0; >> ;

			}
			Port Type ProxyForwardPortT extends ArchPortT with {

			}
			Component Type ServerT extends ArchElementT with {

				Property deploymentLocation : string <<  default : string = "localhost"; >> ;

				Property load : float <<  default : float = 0.0; >> ;

				Property reqServiceRate : float <<  default : float = 0.0; >> ;

				Property byteServiceRate : float <<  default : float = 0.0; >> ;

				Property fidelity : int <<  HIGH : int = 5; LOW : int = 1; default : int = 5; >> ;

				Property cost : float <<  default : float = 1.0; >> ;

				Property lastPageHit : Record [uri : string; cnt : int; kbytes : float; ];

				Property anotherConstraint : string
						<<  default : string = "heuristic self.load <= MAX_UTIL;"; >> ;
			}
			Role Type ReceiverRoleT extends ArchRoleT with {

			}
			Connector Type ProxyConnT extends ArchConnT with {
				Role req : RequestorRoleT = new RequestorRoleT extended with {

				}
				Role rec : ReceiverRoleT = new ReceiverRoleT extended with {

				}
			}
			Component Type ClientT extends ArchElementT with {

				Property deploymentLocation : string <<  default : string = "localhost"; >> ;

				Property experRespTime : float <<  default : float = 100.0; >> ;

				Property reqRate : float <<  default : float = 0.0; >> ;
				rule primaryConstraint = invariant self.experRespTime <= MAX_RESPTIME;
				rule reverseConstraint = heuristic self.experRespTime >= MIN_RESPTIME;

			}
			Port Type HttpReqPortT extends ArchPortT with {

			}
			Connector Type HttpConnT extends ArchConnT with {

				Property bandwidth : float <<  default : float = 0.0; >> ;

				Property latency : float <<  default : float = 0.0; >> ;

				Property numReqsSuccess : int <<  default : int = 0; >> ;

				Property numReqsRedirect : int <<  default : int = 0; >> ;

				Property numReqsClientError : int <<  default : int = 0; >> ;

				Property numReqsServerError : int <<  default : int = 0; >> ;

				Property latencyRate : float;
				Role req : RequestorRoleT = new RequestorRoleT extended with {

				}
				Role rec : ReceiverRoleT = new ReceiverRoleT extended with {

				}
			}

			Property MIN_RESPTIME : float;

			Property MAX_RESPTIME : float;

			Property TOLERABLE_PERCENT_UNHAPPY : float;

			Property UNHAPPY_GRADIENT_1 : float;

			Property UNHAPPY_GRADIENT_2 : float;

			Property UNHAPPY_GRADIENT_3 : float;

			Property FRACTION_GRADIENT_1 : float;

			Property FRACTION_GRADIENT_2 : float;

			Property FRACTION_GRADIENT_3 : float;

			Property MIN_UTIL : float;

			Property MAX_UTIL : float;

			Property MAX_FIDELITY_LEVEL : int;

			Property THRESHOLD_FIDELITY : int;

			Property THRESHOLD_COST : float;

			Property SUPPORT_FRACTION_GRADIENT : boolean;
		}
	
		System ZNewsSys : ZNewsFam = {
	
			Property MIN_RESPTIME : float = 100.0;
	
			Property MAX_RESPTIME : float = 1000.0;
	
			Property UNHAPPY_GRADIENT_1 : float = 0.1;
	
			Property UNHAPPY_GRADIENT_2 : float = 0.2;
	
			Property UNHAPPY_GRADIENT_3 : float = 0.5;
	
			Property FRACTION_GRADIENT_1 : float = 0.2;
	
			Property FRACTION_GRADIENT_2 : float = 0.4;
	
			Property FRACTION_GRADIENT_3 : float = 1.0;
	
			Property TOLERABLE_PERCENT_UNHAPPY : float = 0.4;
	
			Property MIN_UTIL : float = 0.1;
	
			Property MAX_UTIL : float = 0.75;
	
			Property MAX_FIDELITY_LEVEL : int = 5;
	
			Property THRESHOLD_FIDELITY : int = 2;
	
			Property THRESHOLD_COST : float = 4.0;
	
			Property SUPPORT_FRACTION_GRADIENT : boolean = false;

			Component s1 : ServerT, ArchElementT = new ServerT, ArchElementT extended with {
	
				Property deploymentLocation = "phoenix";

				Property isArchEnabled = true;

				Property cost = 1.0;

				Property fidelity = 3;

				Property load = 0.891;
				Port http0 : HttpPortT, ArchPortT = new HttpPortT, ArchPortT extended with {

				}
	
			}

			Component lbproxy : ProxyT = new ProxyT extended with {
	
				Property deploymentLocation = "127.0.0.1";

				Property isArchEnabled = true;

				Property load = 0.01;
				
				Port fwd0 : ProxyForwardPortT = new ProxyForwardPortT extended with {

						Property isArchEnabled = true;
				}
				Port fwd1 : ProxyForwardPortT = new ProxyForwardPortT extended with {

				}
				Port fwd2 : ProxyForwardPortT = new ProxyForwardPortT extended with {

				}
				Port fwd3 : ProxyForwardPortT = new ProxyForwardPortT extended with {

				}
				Port http0 : HttpPortT = new HttpPortT extended with {

						Property isArchEnabled = true;
				}
				Port http1 : HttpPortT = new HttpPortT extended with {

						Property isArchEnabled = true;
				}
				Port http2 : HttpPortT = new HttpPortT extended with {

						Property isArchEnabled = true;
				}	
			}

			Component s2 : ServerT, ArchElementT = new ServerT, ArchElementT extended with {
	
				Property deploymentLocation = "127.0.0.3";

				Property isArchEnabled = true;

				Property fidelity = 5;

				Property load = 0.99;

				Property cost = 1.0;
				
				Port http0 : HttpPortT, ArchPortT = new HttpPortT, ArchPortT extended with {

						Property isArchEnabled = false;
				}
	
			}

			Component s3 : ServerT, ArchElementT = new ServerT, ArchElementT extended with {

				Property deploymentLocation = "127.0.0.4";

				Property isArchEnabled = true;

				Property cost = 1.0;

				Property fidelity = 3;

				Property load = 0.891;
				
				Port http0 : HttpPortT, ArchPortT = new HttpPortT, ArchPortT extended with {

				}	
			}

			Component s0 : ServerT, ArchElementT = new ServerT, ArchElementT extended with {
	
				Property deploymentLocation = "oracle";

				Property cost = 0.9;

				Property fidelity = 3;

				Property load = 0.594;

				Property isArchEnabled = true;

				Port http0 : HttpPortT = new HttpPortT extended with {

						Property isArchEnabled = true;
				}
			}
			Component c1 : ClientT = new ClientT extended with {
	
				Property deploymentLocation = "127.0.0.1";

				Property isArchEnabled = true;

				Property experRespTime = 433.36273;
				
				Port p0 : HttpReqPortT = new HttpReqPortT extended with {

						Property isArchEnabled = true;
				}
			}

			Component c2 : ClientT = new ClientT extended with {

				Property deploymentLocation = "127.0.0.1";

				Property isArchEnabled = true;

				Property experRespTime = 344.6827;
				
				Port p0 : HttpReqPortT = new HttpReqPortT extended with {

						Property isArchEnabled = true;
				}	
			}

			Component c0 : ClientT = new ClientT extended with {
	
				Property deploymentLocation = "127.0.0.1";

				Property isArchEnabled = true;

				Property experRespTime = 414.76843;

				Port p0 : HttpReqPortT = new HttpReqPortT extended with {

						Property isArchEnabled = true;
				}
			}

			Connector conn0 : HttpConnT = new HttpConnT extended with {
	
				Property latencyRate = 0.0;

				Property isArchEnabled = true;

				Role req  = {

						Property isArchEnabled = true;
				}
				Role rec  = {

						Property isArchEnabled = true;
				}
			}

			Connector proxyconn0 : ProxyConnT = new ProxyConnT extended with {

				Property isArchEnabled = true;

				Role req  = {

						Property isArchEnabled = true;

				}

				Role rec  = {

						Property isArchEnabled = true;
				}
			}

			Connector proxyconn1 : ProxyConnT, ArchConnT = new ProxyConnT, ArchConnT extended with {
	
			}
			Connector proxyconn3 : ProxyConnT, ArchConnT = new ProxyConnT, ArchConnT extended with {
	
			}

			Connector proxyconn2 : ProxyConnT, ArchConnT = new ProxyConnT, ArchConnT extended with {
	
			}

			Connector conn : HttpConnT = new HttpConnT extended with {
	
				Property latencyRate = 0.0;

				Property isArchEnabled = true;

				Role req  = {

						Property isArchEnabled = true;	
				}
				Role rec  = {

						Property isArchEnabled = true;
				}
			}

			Connector conn1 : HttpConnT = new HttpConnT extended with {
	
				Property latencyRate = 0.0;

				Property isArchEnabled = true;

				Role req  = {

						Property isArchEnabled = true;
				}
				Role rec  = {

						Property isArchEnabled = true;
				}
			}

			Attachment lbproxy.fwd0 to proxyconn0.req;
			Attachment s0.http0 to proxyconn0.rec;
			Attachment lbproxy.http0 to conn0.rec;
			Attachment c1.p0 to conn.req;
			Attachment c2.p0 to conn1.req;
			Attachment lbproxy.http2 to conn1.rec;
			Attachment lbproxy.http1 to conn.rec;
			Attachment c0.p0 to conn0.req;
			Attachment s2.http0 to proxyconn2.rec;
			Attachment lbproxy.fwd1 to proxyconn1.req;
			Attachment s1.http0 to proxyconn1.rec;
			Attachment s3.http0 to proxyconn3.rec;
			Attachment lbproxy.fwd3 to proxyconn3.req;
			Attachment lbproxy.fwd2 to proxyconn2.req;
		}
	\end{Verbatim}

\newpage

\section{Tácticas de Znn}
\label{sec:tacticasZNN}

	\begin{Verbatim}
		module newssite.tactics;
	
		import model "ZNewsSys.acme" { ZNewsSys as M, ZNewsFam as T };
		import op "znews0.operator.EffectOp" { EffectOp as S };
		import op "org.sa.rainbow.stitch.lib.*";
	
	
		/**
		* Enlist n free servers into service pool.
		* Utility: [v] R; [^] C; [<>] F
		*/
		tactic enlistServers (int n) {
			condition {
				// some client should be experiencing high response time
				exists c : T.ClientT in M.components | c.experRespTime > M.MAX_RESPTIME;
				// there should be enough available server resources
				Model.availableServices(T.ServerT) >= n;
			}
			action {
				set servers = Set.randomSubset(Model.findServices(T.ServerT), n);
				for (T.ServerT freeSvr : servers) {
					S.activateServer(freeSvr);
				}
			}
			effect {
				// response time decreasing below threshold should result
				forall c : T.ClientT in M.components | c.experRespTime <= M.MAX_RESPTIME;
			}
		}
	
		/**
		* Deactivate n servers from service pool into free pool.
		* Utility: [^] R; [v] C; [<>] F
		*/
		tactic dischargeServers (int n) {
			condition {
				// there should be NO client with high response time
				forall c : T.ClientT in M.components | c.experRespTime <= M.MAX_RESPTIME;
				// there should be enough servers to discharge
				Set.size({ select s : T.ServerT in M.components | s.load < M.MIN_UTIL }) >= n;
			}
			action {
				set lowUtilSvrs = { select s : T.ServerT in M.components | s.load < M.MIN_UTIL };
				set subLowUtilSvrs = Set.randomSubset(lowUtilSvrs, n);
				for (T.ServerT s : subLowUtilSvrs) {
					S.deactivateServer(s);
				}
			}
			effect {
				// still NO client with high response time
				forall c : T.ClientT in M.components | c.experRespTime <= M.MAX_RESPTIME;
			}
		}
	
		/**
		* Lowers fidelity by integral steps for percent of requests.
		* Utility: [v] R; [v] C; [v] F
		*/
		tactic lowerFidelity (int step, float fracReq) {
			condition {
				// some client should be experiencing high response time
				exists c : T.ClientT in M.components | c.experRespTime > M.MAX_RESPTIME;
				// exists server with fidelity to lower
				exists s : T.ServerT in M.components | s.fidelity > step;
			}
			action {
				// retrieve set of servers who still have enough fidelity grade to lower
				set servers = { select s : T.ServerT in M.components | s.fidelity > step };
				for (T.ServerT s : servers) {
					S.setFidelity(s, s.fidelity - step);
				}
			}
			effect {
				// response time decreasing below threshold should result
				forall c : T.ClientT in M.components | c.experRespTime <= M.MAX_RESPTIME;
			}
		}
	
		/**
		* Raises fidelity by integral steps for percent of requests.
		* Utility: [^] R; [^] C; [^] F
		*/
		tactic raiseFidelity (int step, float fracReq) {
			condition {
				// there should be NO client with high response time
				forall c : T.ClientT in M.components | c.experRespTime <= M.MAX_RESPTIME;
				// there exists some client with below low-threshold response time
				exists c : T.ClientT in M.components | c.experRespTime < M.MIN_RESPTIME;
			}
			action {
				// first find the lowest fidelity set
				set servers = { select s :
						T.ServerT in M.components | s.fidelity <= M.MAX_FIDELITY_LEVEL - step};
			for (T.ServerT s : servers) {
					S.setFidelity(s, java.lang.Math.min(s.fidelity + step, M.MAX_FIDELITY_LEVEL));
				}
			}
			effect {
				// still NO client with high response time
				forall c : T.ClientT in M.components | c.experRespTime <= M.MAX_RESPTIME;
			}
		}
	\end{Verbatim}

\newpage

	\section{Representación en XML de una configuración de \emph{Self Healing}}
	\label{sec:SelfHealingConfigXML}
			\begin{Verbatim}[gobble=4]
				<selfHealingConfiguration description="test">
				  <artifacts>
				    <artifact id="0" name="ClientT" systemName="ZNewsSys"/>
				    <artifact id="1" name="ServerT" systemName="ZNewsSys"/>
				  </artifacts>
				  <environments>
				    <environment id="0" name="NORMAL">
				      <conditions>
				        <numericBinaryRelationalConstraint>
				          <artifact reference="../../../../../artifacts/artifact"/>
				          <property>experRespTime</property>
				          <quantifier>IN_AVERAGE</quantifier>
				          <binaryOperator>LESS_THAN</binaryOperator>
				          <constantToCompareThePropertyWith class="int">800</constantToCompareThePropertyWith>
				        </numericBinaryRelationalConstraint>
				      </conditions>
				      <weights class="tree-map">
				        <no-comparator/>
				        <entry>
				          <concern>RESPONSE_TIME</concern>
				          <double>0.333</double>
				        </entry>
				        <entry>
				          <concern>SERVER_COST</concern>
				          <double>0.333</double>
				        </entry>
				        <entry>
				          <concern>CONTENT_FIDELITY</concern>
				          <double>0.333</double>
				        </entry>
				      </weights>
				    </environment>
				    <environment id="1" name="HIGH LOAD">
				      <conditions>
				        <numericBinaryRelationalConstraint>
				          <artifact reference="../../../../../artifacts/artifact"/>
				          <property>experRespTime</property>
				          <quantifier>IN_AVERAGE</quantifier>
				          <binaryOperator>GREATER_THAN</binaryOperator>
				          <constantToCompareThePropertyWith class="int">800</constantToCompareThePropertyWith>
				        </numericBinaryRelationalConstraint>
				      </conditions>
				      <weights class="tree-map">
				        <no-comparator/>
				        <entry>
				          <concern>RESPONSE_TIME</concern>
				          <double>0.7</double>
				        </entry>
				        <entry>
				          <concern>SERVER_COST</concern>
				          <double>0.2</double>
				        </entry>
				        <entry>
				          <concern>CONTENT_FIDELITY</concern>
				          <double>0.1</double>
				        </entry>
				      </weights>
				    </environment>
				  </environments>
				  <scenarios>
				    <selfHealingScenario id="0" name="Client Experienced Response Time Scenario"
				    	enabled="true" priority="1">
				      <concern>RESPONSE_TIME</concern>
				      <stimulus name="GetNewsContentClientStimulus" source="Any Client requesting news content"
				      	any="false"/>
				      <environments>
				        <anyEnvironment></anyEnvironment>
				      </environments>
				      <artifact reference="../../../artifacts/artifact"/>
				      <response>Requested News Content</response>
				      <responseMeasure>
				        <description>Experienced response time is within threshold</description>
				        <constraint class="numericBinaryRelationalConstraint">
				          <artifact reference="../../../../../artifacts/artifact"/>
				          <property>experRespTime</property>
				          <quantifier>IN_AVERAGE</quantifier>
				          <binaryOperator>LESS_THAN</binaryOperator>
				          <constantToCompareThePropertyWith class="int">500</constantToCompareThePropertyWith>
				        </constraint>
				      </responseMeasure>
				      <repairStrategies class="specificRepairStrategies">
				        <repairStrategy>VariedReduceResponseTime</repairStrategy>
				      </repairStrategies>
				    </selfHealingScenario>
				    <selfHealingScenario id="1" name="Server Cost Scenario" enabled="true" priority="2">
				      <concern>SERVER_COST</concern>
				      <stimulus any="true"/>
				      <environments>
				        <anyEnvironment reference="../../../selfHealingScenario/environments/anyEnvironment"/>
				      </environments>
				      <artifact reference="../../../artifacts/artifact[2]"/>
				      <response>The proper response for the request</response>
				      <responseMeasure>
				        <description>Active servers amount is within threshold</description>
				        <constraint class="numericBinaryRelationalConstraint">
				          <artifact reference="../../../../../artifacts/artifact[2]"/>
				          <property>cost</property>
				          <quantifier>SUM</quantifier>
				          <binaryOperator>LESS_THAN</binaryOperator>
				          <constantToCompareThePropertyWith class="int">4</constantToCompareThePropertyWith>
				        </constraint>
				      </responseMeasure>
				      <repairStrategies class="specificRepairStrategies">
				        <repairStrategy>ReduceOverallCost</repairStrategy>
				      </repairStrategies>
				    </selfHealingScenario>
				  </scenarios>
				</selfHealingConfiguration>
			\end{Verbatim}

\section{Representación en XML del Escenario de Tiempo de Res\-pues\-ta}
\label{sec:scenarioExpRespTimeXML}

	\begin{Verbatim}
		<selfHealingScenario id="0" name="Client Experienced Response Time Scenario" enabled="true"
			priority="1">
			<concern>RESPONSE_TIME</concern>
			<stimulusSource>Any Client requesting news content</stimulusSource>
			<stimulus>GetNewsContentClientStimulus</stimulus>
			<environments>
				<defaultEnvironment></defaultEnvironment>
			</environments>
			<artifact reference="../../../artifacts/artifact"/>
			<response>Requested News Content</response>
			<responseMeasure>
				<description>Experienced response time is within threshold</description>
				<constraint class="numericBinaryRelationalConstraint" sum="false">
					<artifact reference="../../../../../artifacts/artifact"/>
					<property>experRespTime</property>
					<binaryOperator>LESS_THAN</binaryOperator>
					<constantToCompareThePropertyWith class="int">600
						</constantToCompareThePropertyWith>
				</constraint>
			</responseMeasure>
			<architecturalDecisions/>
			<repairStrategy></repairStrategy>
		</selfHealingScenario>
	\end{Verbatim}

\newpage

\section{Representación en XML del Escenario de Costo}
\label{sec:scenarioCostXML}

	\begin{Verbatim}
		<selfHealingScenario id="1" name="Server Cost Scenario" enabled="true" priority="2">
		    <concern>SERVER_COST</concern>
		    <stimulusSource>Anyone</stimulusSource>
		    <stimulus>ANY</stimulus>
		    <environments>
		        <defaultEnvironment reference="../../../selfHealingScenario/environments/defaultEnvironment"/>
		    </environments>
		    <artifact reference="../../../artifacts/artifact[2]"/>
		        <response>The proper response for the request</response>
		        <responseMeasure>
		            <description>Active servers amount is within threshold</description>
		                <constraint class="numericBinaryRelationalConstraint" sum="true">
		                    <artifact reference="../../../../../artifacts/artifact[2]"/>
		                    <property>cost</property>
		                    <binaryOperator>LESS_THAN_OR_EQUALS</binaryOperator>
		                     <constantToCompareThePropertyWith class="int">1</constantToCompareThePropertyWith>
		                </constraint>
		        </responseMeasure>
		        <architecturalDecisions/>
		        <repairStrategy></repairStrategy>
		</selfHealingScenario>
	\end{Verbatim}

\newpage

\section{Implementación de Probe y extensión de Arco Iris}
\label{sec:probesCode}

	\begin{Verbatim}[gobble=4]
				public class ClientProxyProbe {
					
					...
					
					public void run() {
						byte[] bytes = new byte[Util.MAX_BYTES];
						URL url = new URL(urlStr);
						HttpURLConnection httpConn = (HttpURLConnection) url.openConnection();
						ByteArrayOutputStream baos = new ByteArrayOutputStream();
						int cnter = 0;
						long startTime = System.currentTimeMillis();
						int length = httpConn.getContentLength();
						BufferedInputStream in = new BufferedInputStream(httpConn.getInputStream());
						while (in.available() > 0 || cnter < length) {
							int cnt = in.read(bytes);
							baos.write(bytes, 0, cnt);
							cnter += cnt;
						}
						long endTime = System.currentTimeMillis();
						String rpt = "[" + Util.probeLogTimestamp() + "]<" + id() + "> " + 
									url.getHost() + ":" + (endTime - startTime) + "ms";
						reportData(rpt);
						try {
							Thread.sleep(sleepTime());
						} catch (InterruptedException e) {
							// intentional ignore
						}
					}
			
					...
				}

	\end{Verbatim}

\newpage

	\begin{Verbatim}[gobble=4]
				public class ClientProxyProbeWithStimulus {

					...
					
					public void run() {
						byte[] bytes = new byte[Util.MAX_BYTES];
						URL url = new URL(urlStr);
						HttpURLConnection httpConn = (HttpURLConnection) url.openConnection();
						ByteArrayOutputStream baos = new ByteArrayOutputStream();
						int cnter = 0;
						long startTime = System.currentTimeMillis();
						int length = httpConn.getContentLength();
						BufferedInputStream in = new BufferedInputStream(httpConn.getInputStream());
						while (in.available() > 0 || cnter < length) {
							int cnt = in.read(bytes);
							baos.write(bytes, 0, cnt);
							cnter += cnt;
						}
						long endTime = System.currentTimeMillis();
						String rpt = "[" + Util.probeLogTimestamp() + "]<" + id() + "> " + 
								url.getHost() + "<stimulus:" + stimulusName + ">:" 
								+ (endTime - startTime) + "ms";
						reportData(rpt);
						httpConn.disconnect();
						try {
							Thread.sleep(sleepTime());
						} catch (InterruptedException e) {
							// intentional ignore
						}
					}

					...

	\end{Verbatim}

\newpage


\section{Implementación de NumericBinaryRelationalConstraint}
\label{sec:numericBinaryRelationalConstraintCode}

	\begin{Verbatim}[gobble=4]
				@XStreamAlias("numericBinaryRelationalConstraint")
				public class NumericBinaryRelationalConstraint 
						extends BaseSinglePropertyInvolvedConstraint {
				
					private NumericBinaryOperator binaryOperator;
				
					private Number constantToCompareThePropertyWith;
				
					@XStreamOmitField
					private String exponentialPropertyName;
				
					public NumericBinaryRelationalConstraint(Quantifier quantifier, Artifact artifact, 
							String property,NumericBinaryOperator binaryOperator, 
							Number constantToCompareThePropertyWith) {
						super(artifact, property);
						this.quantifier = quantifier;
						this.binaryOperator = binaryOperator;
						this.constantToCompareThePropertyWith = constantToCompareThePropertyWith;
					}			
					
					public boolean holds(Number expValue) {
						boolean holds = this.binaryOperator.performOperation(expValue, 
								this.constantToCompareThePropertyWith);
						return holds;
					}
				
					...
				}	
	
	\end{Verbatim}
	
\section{Instrucciones para ejecutar ``Arco Iris UI''}
	\todo{Completar!!!}