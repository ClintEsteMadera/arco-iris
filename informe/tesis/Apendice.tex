\appendix
\clearpage
\addappheadtotoc
\appendixpage

\section{Instalación y Ejecución de Arco Iris y Arco Iris UI}
\label{sec:instalacionYEjecucionArcoIris}

	\todo{Revisar y actualizar todos los apendices}

	\subsection{Aclaración importante}

		En el DVD que acompaña al presente trabajo, se incluye el código fuente de Rainbow, Arco Iris y Arco Iris UI, así
		también como la totalidad de las herramientas necesarias para visualizar, compilar y ejecutar dichas aplicaciones. De
		cualquier manera, describiremos brevemente los requisitos y pasos necesarios para que cualquier persona interesada
		pueda instalar y ejecutar las aplicaciones producto  de este trabajo.

	\subsection{Prerrequisitos}
	\label{sec:prerrequisitos}

		\subsubsection{Requisitos para la Ejecución de las Aplicaciones}

			\subsubsubsection{Java 6.0 o superior}

			Tanto Rainbow como Arco Iris y Arco Iris UI son aplicaciones Java que necesitan de una máquina virtual Java instalada
			en la computadora dónde se desee ejecutar estas aplicaciones. La misma se encuentra disponible para la gran
			mayoría de las plataformas utilizadas comúnmente (Windows, Unix, Solaris, MAC OS, etc.) y puede ser descargada
			gratuitamente desde \url{http://www.oracle.com/technetwork/java/javase/downloads/index.html}.
			
			Luego de instalar la máquina virtual de Java, es necesario configurar la variable de entorno \verb@JAVA_HOME@ para
			que apunte al directorio de instalación. Ejemplos:
			
			\noindent En Windows:
			\begin{Verbatim}[gobble=4]			
				JAVA_HOME = %ProgramFiles%\Java\jdk1.6.0_23
			\end{Verbatim}

			\noindent En Linux:
			\begin{Verbatim}[gobble=4]			
				JAVA_HOME = /usr/lib/jvm/java-6-sun
			\end{Verbatim}

			Luego, es necesario que el ejecutable de Java se encuentre en el \emph{path} del sistema operativo. Para lograr esto,
			es necesario hacer lo siguiente:

			\noindent En Windows:
			\begin{Verbatim}[gobble=4]			
				PATH = %PATH%;%JAVA_HOME%\bin
			\end{Verbatim}
			
			\noindent En Linux:
			\begin{Verbatim}[gobble=4]			
				PATH = $PATH:$JAVA_HOME/bin
			\end{Verbatim}
			
			Para verificar que el ejecutable de Java va a poder ser utilizado normalmente, ejecutar el siguiente comando:
			
			\begin{Verbatim}[gobble=4]			
				> java -version
			\end{Verbatim} 
			
			\noindent Se debería obtener una respuesta de este tipo:

			\begin{Verbatim}[gobble=4]			
				java version "1.6.0_21"
				Java(TM) SE Runtime Environment (build 1.6.0_21-b06)
				Java HotSpot(TM) 64-Bit Server VM (build 17.0-b16, mixed mode)
			\end{Verbatim}
			
		\subsubsection{Requisitos para la Inspección y Edición del Código Fuente}

			\subsubsubsection{Eclipse 3.6 o superior}

			En el caso en que se desee inspeccionar o editar el código fuente de Rainbow, Arco Iris y/o Arco Iris UI, una
			herramienta no imprescindible aunque muy recomendada es \textbf{Eclipse}. Eclipse es un entorno de desarrollo
			integrado que permite visualizar, editar, compilar y ejecutar aplicaciones Java (entre muchas otras cosas). Se
			descarga gratuitamente desde \url{http://www.eclipse.org/downloads} y la versión ``for Java Developers'' es
			suficiente a los fines de trabajar con las aplicaciones que conciernen a este trabajo.
			
			El código fuente incluído incluye metadatos de Eclipse, con lo cual, si se utilizan los correspondientes
			\emph{plugins} detallados a continuación, debería ser relativamente sencillo poder disponer rápidamente de todos
			los proyectos que conforman el tandem Rainbow-Arco Iris. los \emph{plugins} de Eclipse requeridos son:

			\begin{itemize}
				\item \textbf{Maven plugin}: El plugin para Eclipse de Maven. El mismo puede ser obtenido utilizando el
				\emph{Marketplace} de Eclipse o utilizando la siguiente URI
				\url{http://m2eclipse.sonatype.org/sites/m2e}.\footnote{Se presupone que el lector está familiarizado con el
				mecanismo de instalación de un \emph{plugin} de Eclipse, caso contrario, ver una explicación en la siguiente página
				web: \url{http://wiki.eclipse.org/FAQ_How_do_I_install_new_plug-ins\%3F}}
				\item \textbf{Subclipse}: Se trata del plugin para Eclipse que provee soporte para interactuar con repositorios
				Subversion\footnote{Para más información sobre Subversion, visitar \url{http://subversion.tigris.org/}}. Tanto
				el código de Rainbow como el de Arco Iris se encuentran alojados en servidores Subversion (SVN).
			\end{itemize}

			\subsubsubsection{Maven 2 o superior}

			A fin de compilar y empaquetar el código fuente de la aplicación mediante la línea de comandos del sistema operativo,
			es necesario utilizar Maven, la popular herramienta de construcción de aplicaciones Java. Maven es una
			aplicación multi plataforma con una abundante cantidad de documentación de calidad, la cual puede ser consultada
			visitando su página web: \url{http://maven.apache.org/}, desde la cual se pueden descargar también los binarios
			de dicha aplicación.
			
			Para instalar Maven, basta con descomprimir el archivo \verb@.zip@ (o \verb@.tar.gz@) en un directorio a elección y
			luego configurar la variables \verb@M2_HOME@ para que apunte a dicho directorio:

			\begin{Verbatim}[gobble=4]			
				M2_HOME = ~/apache-maven-3.0.3
			\end{Verbatim}

			Luego, es necesario que el ejecutable de Maven se encuentre en el \emph{path} del sistema operativo. Para ello, es
			necesario hacer lo siguiente:

			\begin{Verbatim}[gobble=4]			
				PATH = $PATH:$M2_HOME/bin
			\end{Verbatim}

			Para chequear si Maven va a poder ser utilizado normalmente, ejecutar el siguiente comando:
			
			\begin{Verbatim}[gobble=4]			
				> mvn --version
			\end{Verbatim} 
			
			\noindent Se debería obtener una respuesta de este tipo:

			\begin{Verbatim}[gobble=4]
				Apache Maven 3.0.3 (r1075438; 2011-02-28 14:31:09-0300)
				Maven home: ~/apache-maven-3.0.3
				Java version: 1.6.0_21, vendor: Sun Microsystems Inc.
				Java home: /usr/lib/jvm/java-6-sun-1.6.0.21/jre
				Default locale: en_US, platform encoding: UTF-8
				OS name: "linux", version: "2.6.38-8-generic", arch: "amd64", family: "unix"
			\end{Verbatim}

	\subsection{Obtención del código fuente de Rainbow, Arco Iris y Arco Iris UI}
	
		El grupo ABLE posee un repositorio SVN privado, el cuál es sólo accesible mediante el otorgamiento de un usuario
		(normalmente de sólo lectura) con contraseña, a pedido explícito del interesado. A fin de obtener dichas credenciales
		de acceso, es necesario redactar un e-mail a David Garlan $<$\url{garlan@cs.cmu.edu}$>$. Sin embargo, no es necesario
		obtener estas credenciales puesto que en el repositorio SVN de Arco Iris (\url{http://code.google.com/p/arco-iris}) se
		puede encontrar todo el código necesario a los fines del presente trabajo.

		Tanto Arco Iris como Arco Iris UI son de código abierto (\emph{open source}), esto significa que cualquier persona
		puede acceder libremente al código fuente y examinarlo.

	\subsection{Estructura de Directorios del Presente Trabajo}

		A continuación, se observa la estructura de directorios del código fuente de las aplicaciones creadas/modificadas en
		el presente trabajo.
		
		\begin{figure}[h]
			\centering
				\includegraphics{images/directory_structure_root.png}
			\caption{Estructura de directorios de este trabajo}
		\end{figure}

 		\begin{center}
 			\begin{tabularx}{\textwidth}{p{3cm}X}
	  			\textbf{doc} & Aquí se incluye un subconjunto de la bibliografía utilizada para la realización del presente
	  			trabajo, a modo de referencia rápida en caso de estar leyendo el presente informe en forma digital.
	  		\end{tabularx}
	  		\begin{tabularx}{\textwidth}{p{3cm}X}
	  			\textbf{informe} & Incluye la propuesta de tesis y este documento en formato PDF.
	  		\end{tabularx}
	  		\begin{tabularx}{\textwidth}{p{3cm}X}
	  			\textbf{projects} & Aquí se encuentra la totalidad del código fuente correspondiente a las aplicaciones objeto de
	  			este trabajo: Arco Iris, Arco Iris UI, JFaceGUI (a continuación, veremos de qué se trata este proyecto) y algunos
	  			módulos de Rainbow que fueron ligeramente modificados. 
	  		\end{tabularx}
			\begin{tabularx}{\textwidth}{p{3cm}X}
				\textbf{software} & Aquí se incluyen los prerequisitos para compilar y ejecutar las aplicaciones. (ver apéndice
				\ref{sec:prerrequisitos})
 			\end{tabularx}
 		\end{center}

		Hilando más fino en el directorio más importante de los anteriormente mencionados, observamos los proyectos contenidos
		en el directorio \verb@projects@:
		
		\begin{figure}[h]
			\centering
				\includegraphics{images/directory_structure_projects.png}
				\caption{Estructura de directorios del directorio ``projects''}
		\end{figure}
		
		 \begin{center}
	  		\begin{tabularx}{\textwidth}{p{3cm}X}
	  			\textbf{arco-iris} & La totalidad del código nuevo desarrollado para este trabajo, dividido en
	  			\verb@arco-iris-core@, Arco Iris propiamente dicho; y \verb@arco-iris-ui@.
	  		\end{tabularx}
			\begin{tabularx}{\textwidth}{p{3cm}X}
	  			\textbf{jFaceGUI} & En el desarrollo de una interfaz gráfica para Arco Iris, se observó la oportunidad de aislar
	  			un \emph{framework} genérico de desarrollo de interfaces ricas de usuario basada en JFace-SWT. Este proyecto aúna
	  			todas aquellas características genéricas y se compila y construye de manera 100\% independiente a Arco Iris UI.
	  			Más aún, Arco Iris UI tiene como dependencia al artefacto generado en el proceso de construcción de JFaceGUI.
	  		\end{tabularx}
			\begin{tabularx}{\textwidth}{p{3cm}X}
				\textbf{master-pom} & Este POM\footnote{Para más información sobre los \textbf{P}roject \textbf{O}bject
				\textbf{M}odel de Maven, referirse a \url{http://maven.apache.org/pom.html}} de Maven contiene descripciones de
				características comunes a los tres proyectos relacionados con Arco Iris: \verb@arco-iris-core@,
				\verb@arco-iris-ui@ y \verb@JFaceGUI@. Este último, si bien es independiente de los primeros dos, a los fines de
				este trabajo y por simplicidad, utiliza el \verb@master-pom@ al igual que los otros dos proyectos.
	  		\end{tabularx}
			\begin{tabularx}{\textwidth}{p{3cm}X}
				\textbf{org.sa.rainbow.*} & Aquellos proyectos Java cuyo nombre comienza con el prefijo \verb@org.sa.rainbow@ son
				básicamente \textbf{copias} de submódulos de Rainbow que fueron modificados ligeramente a fines de mejorar
				características como el \emph{logging} de la aplicación, etc. \todo{Revisar bien qué cambios hicimos acá y explicar
				mejor!}
	  		\end{tabularx}
 		\end{center}

	\subsection{Compilación de Arco Iris y Arco Iris UI}

		A fines de compilar y construír los artefactos \verb@.jar@ que luego serán utilizados para ejecutar Arco Iris y Arco
		Iris UI, es necesario:
		\begin{itemize}
			\item construír el \verb@master-pom@, el cual luego será utilizado tanto por Arco Iris como por Arco Iris UI.
			\item instalar las dependencias de \verb@arco-iris-core@ en el repositorio local de Maven.
			\item construír JFaceGUI, \verb@arco-iris-core@ y \verb@arco-iris-ui@ de una sola vez, utilizando el
			\emph{reactor-pom} ubicado dentro del directorio \verb@arco-iris@.
		\end{itemize}

		En los próximos apartados se describirán en detalle estos 3 simples pasos.

		\subsubsection{Construcción del pom maestro}

			El primer paso es muy simple: simplemente es necesario posicionarse en el directorio \verb@master-pom@ e instalar el
			pom que allí se encuentra ubicado:

			\begin{Verbatim}[gobble=4]
				cd master-pom
				mvn clean install
			\end{Verbatim}

			Esto instalará el pom en el repositorio local de Maven. Este pom será utilizado por el resto de los módulos a
			compilar.

		\subsubsection{Instalación Manual de Dependencias del Core de Arco Iris}

			Maven es un sistema de construcción de aplicaciones Java que se basa en el supuesto de que todas las dependencias de
			una aplicación deben ser encontrables en un repositorio de artefactos Maven (ya sea en Internet, o en un repositorio
			\emph{cache} local en la computadora del usuario). La gran mayoría de las dependencias de Arco Iris cumplen con esta
			condición y se pueden encontrar en el repositorio oficial de Maven (\url{http://repo1.maven.org/maven2/}).
			Lamentablemente, las dependencias de Arco Iris relacionadas con Rainbow no se encuentran alojadas en ningún
			repositorio Maven público, y mucho menos aquellos proyectos que se han modificado ligeramente en el curso de este
			trabajo. Es por eso que es necesario, \textbf{instalar manualmente} tales dependencias (archivos \verb@.jar@) a fin
			de que, durante el proceso de construcción, sean encontradas por Maven.
			
			Los comandos a ejecutar están especificados en el archivo de texto\\
			\verb@projects/arco-iris/arco-iris-core/lib/install_missing_artifacts.txt@. Es necesario abrir una consola (Inicio
			$\rightarrow$ Ejecutar $\rightarrow$ \verb@cmd.exe@, en Windows o ALT+F2 $\rightarrow$ \verb@Terminal@ o
			\verb@Konsole@, en Linux) y correr los comandos contenidos en dicho archivo de texto utilizando la técnica de copiar
			y pegar (por alguna razón, ejecutar dicho archivo como \emph{script} no funciona correctamente \todo{ver si esto se
			puede arreglar, es un bardo sino\ldots}). Esto instalará los poms de todas aquellas dependencias a instalar
			manualmente. Luego de realizar lo antedicho, es necesario repetir el mismo proceso una vez más para ahora instalar
			los archivos \verb@.jar@ en el repositorio Maven local. Esto, más una conexión a Internet, debería ser suficiente
			para disponer de todas las dependencias de los proyectos relacionados con Arco Iris.

		\subsubsection{Construcción de los Proyectos con Maven}
		
			Generar los binarios de las tres aplicaciones anteriormente mencionadas, es tan simple como ejecutar los siguientes
			dos comandos:
			
			\begin{Verbatim}[gobble=4]
				cd arco-iris
				mvn clean install
			\end{Verbatim}

			Esto debería generar:
			\begin{enumerate}
				\item el archivo \verb@jFaceGUI-0.0.1-SNAPSHOT.jar@ con los binarios de \textbf{JFaceGUI}, compilados utilizando las
				librerías nativas del sistema operativo subyacente (Windows y Linux están actualmente soportados, para sus versiones
				de 32 y 64 bits)
				\item el archivo \verb@arco-iris-ui-0.0.1-SNAPSHOT-distribution.zip@ que contiene el \verb@.jar@ de \textbf{Arco
				Iris UI} junto con un directorio \verb@lib@ que posee todas las dependencias de dicha aplicación.
				\item un archivo \verb@arco-iris-core-0.0.1-SNAPSHOT-distribution.zip@ que contiene el \verb@.jar@ del \emph{core}
				de \textbf{Arco Iris} junto con un directorio \verb@lib@ que posee todas sus dependencias y un directorio
				\verb@configs@ el cual contiene los casos de prueba realizados en el presente trabajo y detallados en la sección
				\ref{sec:casosPracticos}.
			\end{enumerate}

	\subsection{Ejecución de las aplicaciones}

		\subsubsection{Arco Iris}

			Arco Iris (al igual que Rainbow) toma como parámetros de entrada la ubicación de archivos de configuración que le
			indican a la aplicación la ubicación del sistema al cual adaptar (o datos sobre la simulación de tal sistema),
			ubicación del modelo de la arquitectura de dicho sistema, etc\ldots
			
			Supongamos que se desea invocar a Arco Iris utilizando el caso de prueba denominado como ``TestCase4''. La
			forma de llevar a cabo ésto es la siguiente:
			
			\begin{Verbatim}[gobble=4]
				cd arco-iris/arco-iris-core/target
				unzip arco-iris-core-0.0.1-SNAPSHOT-distribution.zip
				java -Drainbow.config=configs
				     -Drainbow.target=TestCase4
				     -jar arco-iris-core-0.0.1-SNAPSHOT.jar
			\end{Verbatim}

		\subsubsection{Arco Iris UI}

			Ejecutar Arco Iris UI es similar a ejecutar Arco Iris, sólo que la aplicación recibe no recibe parámetros:

			\begin{Verbatim}[gobble=4]
				cd arco-iris/arco-iris-ui/target
				unzip arco-iris-ui-0.0.1-SNAPSHOT-distribution.zip
				java -jar arco-iris-ui-0.0.1-SNAPSHOT.jar
			\end{Verbatim}

\section{Arquitectura de Znn modelada con Acme}
\label{sec:arquitecturaZNN}

	\begin{Verbatim}
		import TargetEnvType.acme;
	
		Family ZNewsFam extends EnvType with {
	
			Port Type HttpPortT extends ArchPortT with {
	
			}
			Role Type RequestorRoleT extends ArchRoleT with {

			}
			Component Type ProxyT extends ArchElementT with {

				Property deploymentLocation : string <<  default : string = "localhost"; >> ;

				Property load : float <<  default : float = 0.0; >> ;

			}
			Port Type ProxyForwardPortT extends ArchPortT with {

			}
			Component Type ServerT extends ArchElementT with {

				Property deploymentLocation : string <<  default : string = "localhost"; >> ;

				Property load : float <<  default : float = 0.0; >> ;

				Property reqServiceRate : float <<  default : float = 0.0; >> ;

				Property byteServiceRate : float <<  default : float = 0.0; >> ;

				Property fidelity : int <<  HIGH : int = 5; LOW : int = 1; default : int = 5; >> ;

				Property cost : float <<  default : float = 1.0; >> ;

				Property lastPageHit : Record [uri : string; cnt : int; kbytes : float; ];

				Property anotherConstraint : string
						<<  default : string = "heuristic self.load <= MAX_UTIL;"; >> ;
			}
			Role Type ReceiverRoleT extends ArchRoleT with {

			}
			Connector Type ProxyConnT extends ArchConnT with {
				Role req : RequestorRoleT = new RequestorRoleT extended with {

				}
				Role rec : ReceiverRoleT = new ReceiverRoleT extended with {

				}
			}
			Component Type ClientT extends ArchElementT with {

				Property deploymentLocation : string <<  default : string = "localhost"; >> ;

				Property experRespTime : float <<  default : float = 100.0; >> ;

				Property reqRate : float <<  default : float = 0.0; >> ;
				rule primaryConstraint = invariant self.experRespTime <= MAX_RESPTIME;
				rule reverseConstraint = heuristic self.experRespTime >= MIN_RESPTIME;

			}
			Port Type HttpReqPortT extends ArchPortT with {

			}
			Connector Type HttpConnT extends ArchConnT with {

				Property bandwidth : float <<  default : float = 0.0; >> ;

				Property latency : float <<  default : float = 0.0; >> ;

				Property numReqsSuccess : int <<  default : int = 0; >> ;

				Property numReqsRedirect : int <<  default : int = 0; >> ;

				Property numReqsClientError : int <<  default : int = 0; >> ;

				Property numReqsServerError : int <<  default : int = 0; >> ;

				Property latencyRate : float;
				Role req : RequestorRoleT = new RequestorRoleT extended with {

				}
				Role rec : ReceiverRoleT = new ReceiverRoleT extended with {

				}
			}

			Property MIN_RESPTIME : float;

			Property MAX_RESPTIME : float;

			Property TOLERABLE_PERCENT_UNHAPPY : float;

			Property UNHAPPY_GRADIENT_1 : float;

			Property UNHAPPY_GRADIENT_2 : float;

			Property UNHAPPY_GRADIENT_3 : float;

			Property FRACTION_GRADIENT_1 : float;

			Property FRACTION_GRADIENT_2 : float;

			Property FRACTION_GRADIENT_3 : float;

			Property MIN_UTIL : float;

			Property MAX_UTIL : float;

			Property MAX_FIDELITY_LEVEL : int;

			Property THRESHOLD_FIDELITY : int;

			Property THRESHOLD_COST : float;

			Property SUPPORT_FRACTION_GRADIENT : boolean;
		}
	
		System ZNewsSys : ZNewsFam = {
	
			Property MIN_RESPTIME : float = 100.0;
	
			Property MAX_RESPTIME : float = 1000.0;
	
			Property UNHAPPY_GRADIENT_1 : float = 0.1;
	
			Property UNHAPPY_GRADIENT_2 : float = 0.2;
	
			Property UNHAPPY_GRADIENT_3 : float = 0.5;
	
			Property FRACTION_GRADIENT_1 : float = 0.2;
	
			Property FRACTION_GRADIENT_2 : float = 0.4;
	
			Property FRACTION_GRADIENT_3 : float = 1.0;
	
			Property TOLERABLE_PERCENT_UNHAPPY : float = 0.4;
	
			Property MIN_UTIL : float = 0.1;
	
			Property MAX_UTIL : float = 0.75;
	
			Property MAX_FIDELITY_LEVEL : int = 5;
	
			Property THRESHOLD_FIDELITY : int = 2;
	
			Property THRESHOLD_COST : float = 4.0;
	
			Property SUPPORT_FRACTION_GRADIENT : boolean = false;

			Component s1 : ServerT, ArchElementT = new ServerT, ArchElementT extended with {
	
				Property deploymentLocation = "phoenix";

				Property isArchEnabled = true;

				Property cost = 1.0;

				Property fidelity = 3;

				Property load = 0.891;
				Port http0 : HttpPortT, ArchPortT = new HttpPortT, ArchPortT extended with {

				}
	
			}

			Component lbproxy : ProxyT = new ProxyT extended with {
	
				Property deploymentLocation = "127.0.0.1";

				Property isArchEnabled = true;

				Property load = 0.01;
				
				Port fwd0 : ProxyForwardPortT = new ProxyForwardPortT extended with {

						Property isArchEnabled = true;
				}
				Port fwd1 : ProxyForwardPortT = new ProxyForwardPortT extended with {

				}
				Port fwd2 : ProxyForwardPortT = new ProxyForwardPortT extended with {

				}
				Port fwd3 : ProxyForwardPortT = new ProxyForwardPortT extended with {

				}
				Port http0 : HttpPortT = new HttpPortT extended with {

						Property isArchEnabled = true;
				}
				Port http1 : HttpPortT = new HttpPortT extended with {

						Property isArchEnabled = true;
				}
				Port http2 : HttpPortT = new HttpPortT extended with {

						Property isArchEnabled = true;
				}	
			}

			Component s2 : ServerT, ArchElementT = new ServerT, ArchElementT extended with {
	
				Property deploymentLocation = "127.0.0.3";

				Property isArchEnabled = true;

				Property fidelity = 5;

				Property load = 0.99;

				Property cost = 1.0;
				
				Port http0 : HttpPortT, ArchPortT = new HttpPortT, ArchPortT extended with {

						Property isArchEnabled = false;
				}
	
			}

			Component s3 : ServerT, ArchElementT = new ServerT, ArchElementT extended with {

				Property deploymentLocation = "127.0.0.4";

				Property isArchEnabled = true;

				Property cost = 1.0;

				Property fidelity = 3;

				Property load = 0.891;
				
				Port http0 : HttpPortT, ArchPortT = new HttpPortT, ArchPortT extended with {

				}	
			}

			Component s0 : ServerT, ArchElementT = new ServerT, ArchElementT extended with {
	
				Property deploymentLocation = "oracle";

				Property cost = 0.9;

				Property fidelity = 3;

				Property load = 0.594;

				Property isArchEnabled = true;

				Port http0 : HttpPortT = new HttpPortT extended with {

						Property isArchEnabled = true;
				}
			}
			Component c1 : ClientT = new ClientT extended with {
	
				Property deploymentLocation = "127.0.0.1";

				Property isArchEnabled = true;

				Property experRespTime = 433.36273;
				
				Port p0 : HttpReqPortT = new HttpReqPortT extended with {

						Property isArchEnabled = true;
				}
			}

			Component c2 : ClientT = new ClientT extended with {

				Property deploymentLocation = "127.0.0.1";

				Property isArchEnabled = true;

				Property experRespTime = 344.6827;
				
				Port p0 : HttpReqPortT = new HttpReqPortT extended with {

						Property isArchEnabled = true;
				}	
			}

			Component c0 : ClientT = new ClientT extended with {
	
				Property deploymentLocation = "127.0.0.1";

				Property isArchEnabled = true;

				Property experRespTime = 414.76843;

				Port p0 : HttpReqPortT = new HttpReqPortT extended with {

						Property isArchEnabled = true;
				}
			}

			Connector conn0 : HttpConnT = new HttpConnT extended with {
	
				Property latencyRate = 0.0;

				Property isArchEnabled = true;

				Role req  = {

						Property isArchEnabled = true;
				}
				Role rec  = {

						Property isArchEnabled = true;
				}
			}

			Connector proxyconn0 : ProxyConnT = new ProxyConnT extended with {

				Property isArchEnabled = true;

				Role req  = {

						Property isArchEnabled = true;

				}

				Role rec  = {

						Property isArchEnabled = true;
				}
			}

			Connector proxyconn1 : ProxyConnT, ArchConnT = new ProxyConnT, ArchConnT extended with {
	
			}
			Connector proxyconn3 : ProxyConnT, ArchConnT = new ProxyConnT, ArchConnT extended with {
	
			}

			Connector proxyconn2 : ProxyConnT, ArchConnT = new ProxyConnT, ArchConnT extended with {
	
			}

			Connector conn : HttpConnT = new HttpConnT extended with {
	
				Property latencyRate = 0.0;

				Property isArchEnabled = true;

				Role req  = {

						Property isArchEnabled = true;	
				}
				Role rec  = {

						Property isArchEnabled = true;
				}
			}

			Connector conn1 : HttpConnT = new HttpConnT extended with {
	
				Property latencyRate = 0.0;

				Property isArchEnabled = true;

				Role req  = {

						Property isArchEnabled = true;
				}
				Role rec  = {

						Property isArchEnabled = true;
				}
			}

			Attachment lbproxy.fwd0 to proxyconn0.req;
			Attachment s0.http0 to proxyconn0.rec;
			Attachment lbproxy.http0 to conn0.rec;
			Attachment c1.p0 to conn.req;
			Attachment c2.p0 to conn1.req;
			Attachment lbproxy.http2 to conn1.rec;
			Attachment lbproxy.http1 to conn.rec;
			Attachment c0.p0 to conn0.req;
			Attachment s2.http0 to proxyconn2.rec;
			Attachment lbproxy.fwd1 to proxyconn1.req;
			Attachment s1.http0 to proxyconn1.rec;
			Attachment s3.http0 to proxyconn3.rec;
			Attachment lbproxy.fwd3 to proxyconn3.req;
			Attachment lbproxy.fwd2 to proxyconn2.req;
		}
	\end{Verbatim}

\newpage

\section{Tácticas de Znn}
\label{sec:tacticasZNN}

	\begin{Verbatim}
		module newssite.tactics;
	
		import model "ZNewsSys.acme" { ZNewsSys as M, ZNewsFam as T };
		import op "znews0.operator.EffectOp" { EffectOp as S };
		import op "org.sa.rainbow.stitch.lib.*";
	
	
		/**
		* Enlist n free servers into service pool.
		* Utility: [v] R; [^] C; [<>] F
		*/
		tactic enlistServers (int n) {
			condition {
				// some client should be experiencing high response time
				exists c : T.ClientT in M.components | c.experRespTime > M.MAX_RESPTIME;
				// there should be enough available server resources
				Model.availableServices(T.ServerT) >= n;
			}
			action {
				set servers = Set.randomSubset(Model.findServices(T.ServerT), n);
				for (T.ServerT freeSvr : servers) {
					S.activateServer(freeSvr);
				}
			}
			effect {
				// response time decreasing below threshold should result
				forall c : T.ClientT in M.components | c.experRespTime <= M.MAX_RESPTIME;
			}
		}
	
		/**
		* Deactivate n servers from service pool into free pool.
		* Utility: [^] R; [v] C; [<>] F
		*/
		tactic dischargeServers (int n) {
			condition {
				// there should be NO client with high response time
				forall c : T.ClientT in M.components | c.experRespTime <= M.MAX_RESPTIME;
				// there should be enough servers to discharge
				Set.size({ select s : T.ServerT in M.components | s.load < M.MIN_UTIL }) >= n;
			}
			action {
				set lowUtilSvrs = { select s : T.ServerT in M.components | s.load < M.MIN_UTIL };
				set subLowUtilSvrs = Set.randomSubset(lowUtilSvrs, n);
				for (T.ServerT s : subLowUtilSvrs) {
					S.deactivateServer(s);
				}
			}
			effect {
				// still NO client with high response time
				forall c : T.ClientT in M.components | c.experRespTime <= M.MAX_RESPTIME;
			}
		}
	
		/**
		* Lowers fidelity by integral steps for percent of requests.
		* Utility: [v] R; [v] C; [v] F
		*/
		tactic lowerFidelity (int step, float fracReq) {
			condition {
				// some client should be experiencing high response time
				exists c : T.ClientT in M.components | c.experRespTime > M.MAX_RESPTIME;
				// exists server with fidelity to lower
				exists s : T.ServerT in M.components | s.fidelity > step;
			}
			action {
				// retrieve set of servers who still have enough fidelity grade to lower
				set servers = { select s : T.ServerT in M.components | s.fidelity > step };
				for (T.ServerT s : servers) {
					S.setFidelity(s, s.fidelity - step);
				}
			}
			effect {
				// response time decreasing below threshold should result
				forall c : T.ClientT in M.components | c.experRespTime <= M.MAX_RESPTIME;
			}
		}
	
		/**
		* Raises fidelity by integral steps for percent of requests.
		* Utility: [^] R; [^] C; [^] F
		*/
		tactic raiseFidelity (int step, float fracReq) {
			condition {
				// there should be NO client with high response time
				forall c : T.ClientT in M.components | c.experRespTime <= M.MAX_RESPTIME;
				// there exists some client with below low-threshold response time
				exists c : T.ClientT in M.components | c.experRespTime < M.MIN_RESPTIME;
			}
			action {
				// first find the lowest fidelity set
				set servers = { select s :
						T.ServerT in M.components | s.fidelity <= M.MAX_FIDELITY_LEVEL - step};
			for (T.ServerT s : servers) {
					S.setFidelity(s, java.lang.Math.min(s.fidelity + step, M.MAX_FIDELITY_LEVEL));
				}
			}
			effect {
				// still NO client with high response time
				forall c : T.ClientT in M.components | c.experRespTime <= M.MAX_RESPTIME;
			}
		}
	\end{Verbatim}

\newpage

	\section{Representación en XML de una configuración de \emph{Self Healing}}
	\label{sec:SelfHealingConfigXML}
			\begin{Verbatim}[gobble=4]
				<selfHealingConfiguration description="test">
				  <artifacts>
				    <artifact id="0" name="ClientT" systemName="ZNewsSys"/>
				    <artifact id="1" name="ServerT" systemName="ZNewsSys"/>
				  </artifacts>
				  <environments>
				    <environment id="0" name="NORMAL">
				      <conditions>
				        <numericBinaryRelationalConstraint>
				          <artifact reference="../../../../../artifacts/artifact"/>
				          <property>experRespTime</property>
				          <quantifier>IN_AVERAGE</quantifier>
				          <binaryOperator>LESS_THAN</binaryOperator>
				          <constantToCompareThePropertyWith class="int">800</constantToCompareThePropertyWith>
				        </numericBinaryRelationalConstraint>
				      </conditions>
				      <weights class="tree-map">
				        <no-comparator/>
				        <entry>
				          <concern>RESPONSE_TIME</concern>
				          <double>0.333</double>
				        </entry>
				        <entry>
				          <concern>SERVER_COST</concern>
				          <double>0.333</double>
				        </entry>
				        <entry>
				          <concern>CONTENT_FIDELITY</concern>
				          <double>0.333</double>
				        </entry>
				      </weights>
				    </environment>
				    <environment id="1" name="HIGH LOAD">
				      <conditions>
				        <numericBinaryRelationalConstraint>
				          <artifact reference="../../../../../artifacts/artifact"/>
				          <property>experRespTime</property>
				          <quantifier>IN_AVERAGE</quantifier>
				          <binaryOperator>GREATER_THAN</binaryOperator>
				          <constantToCompareThePropertyWith class="int">800</constantToCompareThePropertyWith>
				        </numericBinaryRelationalConstraint>
				      </conditions>
				      <weights class="tree-map">
				        <no-comparator/>
				        <entry>
				          <concern>RESPONSE_TIME</concern>
				          <double>0.7</double>
				        </entry>
				        <entry>
				          <concern>SERVER_COST</concern>
				          <double>0.2</double>
				        </entry>
				        <entry>
				          <concern>CONTENT_FIDELITY</concern>
				          <double>0.1</double>
				        </entry>
				      </weights>
				    </environment>
				  </environments>
				  <scenarios>
				    <selfHealingScenario id="0" name="Client Experienced Response Time Scenario"
				    	enabled="true" priority="1">
				      <concern>RESPONSE_TIME</concern>
				      <stimulus name="GetNewsContentClientStimulus" source="Any Client requesting news content"
				      	any="false"/>
				      <environments>
				        <anyEnvironment></anyEnvironment>
				      </environments>
				      <artifact reference="../../../artifacts/artifact"/>
				      <response>Requested News Content</response>
				      <responseMeasure>
				        <description>Experienced response time is within threshold</description>
				        <constraint class="numericBinaryRelationalConstraint">
				          <artifact reference="../../../../../artifacts/artifact"/>
				          <property>experRespTime</property>
				          <quantifier>IN_AVERAGE</quantifier>
				          <binaryOperator>LESS_THAN</binaryOperator>
				          <constantToCompareThePropertyWith class="int">500</constantToCompareThePropertyWith>
				        </constraint>
				      </responseMeasure>
				      <repairStrategies class="specificRepairStrategies">
				        <repairStrategy>VariedReduceResponseTime</repairStrategy>
				      </repairStrategies>
				    </selfHealingScenario>
				    <selfHealingScenario id="1" name="Server Cost Scenario" enabled="true" priority="2">
				      <concern>SERVER_COST</concern>
				      <stimulus any="true"/>
				      <environments>
				        <anyEnvironment reference="../../../selfHealingScenario/environments/anyEnvironment"/>
				      </environments>
				      <artifact reference="../../../artifacts/artifact[2]"/>
				      <response>The proper response for the request</response>
				      <responseMeasure>
				        <description>Active servers amount is within threshold</description>
				        <constraint class="numericBinaryRelationalConstraint">
				          <artifact reference="../../../../../artifacts/artifact[2]"/>
				          <property>cost</property>
				          <quantifier>SUM</quantifier>
				          <binaryOperator>LESS_THAN</binaryOperator>
				          <constantToCompareThePropertyWith class="int">4</constantToCompareThePropertyWith>
				        </constraint>
				      </responseMeasure>
				      <repairStrategies class="specificRepairStrategies">
				        <repairStrategy>ReduceOverallCost</repairStrategy>
				      </repairStrategies>
				    </selfHealingScenario>
				  </scenarios>
				</selfHealingConfiguration>
			\end{Verbatim}

\section{Representación en XML del Escenario de Tiempo de Res\-pues\-ta}
\label{sec:scenarioExpRespTimeXML}

	\begin{Verbatim}
		<selfHealingScenario id="0" name="Client Experienced Response Time Scenario" enabled="true"
			priority="1">
			<concern>RESPONSE_TIME</concern>
			<stimulusSource>Any Client requesting news content</stimulusSource>
			<stimulus>GetNewsContentClientStimulus</stimulus>
			<environments>
				<defaultEnvironment></defaultEnvironment>
			</environments>
			<artifact reference="../../../artifacts/artifact"/>
			<response>Requested News Content</response>
			<responseMeasure>
				<description>Experienced response time is within threshold</description>
				<constraint class="numericBinaryRelationalConstraint" sum="false">
					<artifact reference="../../../../../artifacts/artifact"/>
					<property>experRespTime</property>
					<binaryOperator>LESS_THAN</binaryOperator>
					<constantToCompareThePropertyWith class="int">600
						</constantToCompareThePropertyWith>
				</constraint>
			</responseMeasure>
			<architecturalDecisions/>
			<repairStrategy></repairStrategy>
		</selfHealingScenario>
	\end{Verbatim}

\newpage

\section{Representación en XML del Escenario de Costo}
\label{sec:scenarioCostXML}

	\begin{Verbatim}
		<selfHealingScenario id="1" name="Server Cost Scenario" enabled="true" priority="2">
		    <concern>SERVER_COST</concern>
		    <stimulusSource>Anyone</stimulusSource>
		    <stimulus>ANY</stimulus>
		    <environments>
		        <defaultEnvironment reference="../../../selfHealingScenario/environments/defaultEnvironment"/>
		    </environments>
		    <artifact reference="../../../artifacts/artifact[2]"/>
		        <response>The proper response for the request</response>
		        <responseMeasure>
		            <description>Active servers amount is within threshold</description>
		                <constraint class="numericBinaryRelationalConstraint" sum="true">
		                    <artifact reference="../../../../../artifacts/artifact[2]"/>
		                    <property>cost</property>
		                    <binaryOperator>LESS_THAN_OR_EQUALS</binaryOperator>
		                     <constantToCompareThePropertyWith class="int">1</constantToCompareThePropertyWith>
		                </constraint>
		        </responseMeasure>
		        <architecturalDecisions/>
		        <repairStrategy></repairStrategy>
		</selfHealingScenario>
	\end{Verbatim}

\newpage

\section{Implementación de Probe y extensión de Arco Iris}
\label{sec:probesCode}

	\begin{Verbatim}
		public class ClientProxyProbe {
			...
			public void run() {
				byte[] bytes = new byte[Util.MAX_BYTES];
				URL url = new URL(urlStr);
				HttpURLConnection httpConn = (HttpURLConnection) url.openConnection();
				ByteArrayOutputStream baos = new ByteArrayOutputStream();
				int cnter = 0;
				long startTime = System.currentTimeMillis();
				int length = httpConn.getContentLength();
				BufferedInputStream in = new BufferedInputStream(httpConn.getInputStream());
				while (in.available() > 0 || cnter < length) {
					int cnt = in.read(bytes);
					baos.write(bytes, 0, cnt);
					cnter += cnt;
				}
				long endTime = System.currentTimeMillis();
				String rpt = "[" + Util.probeLogTimestamp() + "]<" + id() + "> " + 
							url.getHost() + ":" + (endTime - startTime) + "ms";
				reportData(rpt);
				try {
					Thread.sleep(sleepTime());
				} catch (InterruptedException e) {
					// intentional ignore
				}
			}
			...
		}
	\end{Verbatim}

\newpage

	\begin{Verbatim}
		public class ClientProxyProbeWithStimulus {
			...
			public void run() {
				byte[] bytes = new byte[Util.MAX_BYTES];
				URL url = new URL(urlStr);
				HttpURLConnection httpConn = (HttpURLConnection) url.openConnection();
				ByteArrayOutputStream baos = new ByteArrayOutputStream();
				int cnter = 0;
				long startTime = System.currentTimeMillis();
				int length = httpConn.getContentLength();
				BufferedInputStream in = new BufferedInputStream(httpConn.getInputStream());
				while (in.available() > 0 || cnter < length) {
					int cnt = in.read(bytes);
					baos.write(bytes, 0, cnt);
					cnter += cnt;
				}
				long endTime = System.currentTimeMillis();
				String rpt = "[" + Util.probeLogTimestamp() + "]<" + id() + "> " + 
						url.getHost() + "<stimulus:" + stimulusName + ">:" 
						+ (endTime - startTime) + "ms";
				reportData(rpt);
				httpConn.disconnect();
				try {
					Thread.sleep(sleepTime());
				} catch (InterruptedException e) {
					// intentional ignore
				}
			}
			...
	\end{Verbatim}

\newpage

\section{Implementación de NumericBinaryRelationalConstraint}
\label{sec:numericBinaryRelationalConstraintCode}

	\begin{Verbatim}
		@XStreamAlias("numericBinaryRelationalConstraint")
		public class NumericBinaryRelationalConstraint 
				extends BaseSinglePropertyInvolvedConstraint {
		
			private NumericBinaryOperator binaryOperator;
		
			private Number constantToCompareThePropertyWith;
		
			@XStreamOmitField
			private String exponentialPropertyName;
		
			public NumericBinaryRelationalConstraint(Quantifier quantifier, Artifact artifact, 
					String property,NumericBinaryOperator binaryOperator, 
					Number constantToCompareThePropertyWith) {
				super(artifact, property);
				this.quantifier = quantifier;
				this.binaryOperator = binaryOperator;
				this.constantToCompareThePropertyWith = constantToCompareThePropertyWith;
			}			
			
			public boolean holds(Number expValue) {
				boolean holds = this.binaryOperator.performOperation(expValue, 
						this.constantToCompareThePropertyWith);
				return holds;
			}
			...
		}	
	\end{Verbatim}

\section{Extracto del \emph{Log} de un Caso de Prueba de Arco Iris}
\label{sec:logCasoPruebaArcoIris}

	\todo{Turco: poner el log del caso 2!!}