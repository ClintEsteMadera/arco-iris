\section{Interfaz Gráfica: Scenarios UI}
	\label{sec:scenariosUI}

	\subsection{Introducción}

		\subsubsection{Motivaciones para una ``GUI''}

			Aún considerando las mejoras provistas por la extensión a Rainbow propuesta en el presente trabajo, uno de los
			escollos más notorios para poder utilizar de manera amena, ágil y productiva a ``Arco Iris'' es, sin dudas, la
			ausencia de una interfaz visual para que los \emph{stakeholders} y arquitectos de la aplicación puedan crear, editar
			y eliminar escenarios, entornos, artifacts y otros conceptos introducidos en ``Arco Iris''; así también como otros
			conceptos ya existentes en ``Rainbow''.
			
			A fin de superar esta dificultad, se propone el desarrollo de una interfaz de usuario gráfica (GUI, de sus siglas en
			inglés: \emph{Graphical User Interface}) para que los distintos \emph{stakeholders}, incluyendo usuarios y
			arquitectos, puedan expresar los requerimientos no funcionales (o ``illities'') del sistema en formato de escenarios
			de QAW, que luego serán importados y utilizados por ``Arco Iris''.
			
			En el presente apartado nos dedicaremos a repasar los aspectos más importantes de la aplicación, bautizada
			``Scenarios UI''.

		\subsubsection{Herramienta de escritorio}

			Hoy en día, con el apogeo de cientos de lenguajes, herramientas, \emph{frameworks}, etc. para desarrollar
			aplicaciones, al momento de definir cuestiones arquitecturales de una interfaz gráfica, muy pocos desarrolladores
			se cuestionan si tiene sentido o no que la misma sea web: la abundancia de herramientas que facilitan el
			enriquecimiento de una interfaz web (que naturalmente es pobre en usabilidad y tiempo de respuesta, entre otras
			cosas) terminan ganando la batalla frente a las aplicaciones conocidas como ``de escritorio''.
			
			Por otro lado, dentro de los argumentos más esgrimidos por los defensores de las interfaces web, se encuentran el
			hecho de su accesibilidad desde cualquier computadora o dispositivo que cuente con un navegador e internet; así como
			también la facilidad de aplicación de parches y actualizaciones a la misma. Estos argumentos son sencillamente
			irrefutables.
			
			Entonces bien, ¿por qué hemos elegido construír ``Scenarios UI'' basado en una interfaz gráfica de usuario de
			escritorio?
			
			\begin{itemize}
				\item porque consideramos que para el caso concreto de ``Arco Iris'', dónde se pretende que los \emph{stakeholders}
				de la aplicación junto a el o los arquitectos de la misma \textbf{colaboren} para llevar a cabo una especificación
				de sus requerimientos de auto reparación para el sistema; es más importante la agilidad de uso y la rapidez de
				respuesta de la aplicación.
				\item porque, gracias a Java Web Start\footnote{\emph{Java Web Start} es una herramienta de Oracle (originalmente
				de Sun) que permite que aplicaciones Java \emph{standalone} sean desplegadas con un sólo click a traves de
				la red, asegurando también que la versión correcta de la máquina virtual de Java (JRE) esté instalada. Más
				información en \url{http://www.oracle.com/technetwork/java/javase/tech/index-jsp-136112.html}}, la aplicación de
				parches o actualizaciones sobre la aplicación es sencillamene automática, conservando así uno de los más grandes
				beneficios de una aplicación web ordinaria.
				\item porque los \emph{widgets} disponibles en la librería \emph{JFace-SWT}\footnote{JFace es un conjunto de widgets
				para realizar interfaces de usuario construido sobre SWT. Fue desarrollado por IBM para facilitar la construcción
				del entorno de desarrollo Eclipse, pero su uso no está limitado a éste. JFace proporciona una serie de
				construcciones muy frecuentes a la hora de desarrollar interfaces gráficas de usuario, tales como cuadros de
				diálogo, evitando al programador la tediosa tarea de lidiar manualmente con los widgets de SWT. Fuente:
				\url{http://es.wikipedia.org/wiki/JFace}} resultan muy adecuados para modelar los diferentes controles
				visuales de la aplicación.
			\end{itemize}
			
			\todo{Implementar realmente con Java Web Start o sacar este chamuyo!}
			
		\subsubsection{Idioma por defecto: inglés}

			Dado que Rainbow es una aplicación originalmente creada en Estados Unidos, y previendo que tanto ``Arco Iris'' como
			``Scenarios UI'' puedan ser aplicaciones tomadas por otros investigadores para ser extendidas, decidimos que lo más
			razonable es que estas aplicaciones estén codificadas en el idioma inglés. En el caso de ``Scenarios UI'', todos los
			textos mostrados en pantalla también están escritos en inglés, aunque todas las etiquetas están externalizadas a
			archivos de configuración 
			
		\subsubsection{Multi plataforma}

			``Scenarios UI'' es, como la gran mayoría de las aplicaciones Java, ejecutable desde los sistemas operativos
			más importantes, como por ejemplo Windows, Unix, MAC OS o Solaris. Debido a la utilización de las librerías SWT-JFace
			para la creación de la herramienta, las cuales poseen dependencias nativas del sistema operativo (i.e. el encargado
			de dibujar y refrescar los componentes visuales no es la máquina virtual de Java sino el sistema operativo) es
			necesario empaquetar la aplicación con diferentes dependencias java (i.e. archivos JAR) en el \emph{classpath} para
			poder correr la aplicación en distintas plataformas. \todo{cuando decidamos como empaquetamos todo, mejorar esta
			subsección}
		
	\subsection{Conceptos básicos de uso de la herramienta}

		\subsubsection{Formato de salida: XML}

			La configuración de \emph{self healing} que ``Scenarios UI'' debe generar debe ser guardada en un archivo, en un
			determinado formato. Consideramos que el mejor formato para dicho archivo es el formato XML porque es un formato
			entendible no sólo por la computadora sino también por seres humanos. Dentro de este tipo de lenguajes (dónde se
			encuentran otros como JSON o YAML\footnote{Para más información sobre estos lenguajes de intercambio de
			datos, visitar \url{http://www.json.org/} o \url{http://www.yaml.org/}}) elegimos el formato XML por ser el más
			ampliamente conocido.
			
			La mecánica de serialización de una configuración de ``Self Healing'' creada en Java utilizando ``Scenarios UI'' a
			XML y la importación de dicho XML en Arco Iris es llevada a cabo utilizando el reconocido parser
			``XStream''\footnote{Para más información, visitar \url{http://xstream.codehaus.org/}}, el cual permite fácilmente
			convertir objetos Java en XML y viceversa.
			
			En la sección \ref{SelfHealingConfigXML} del apéndice, podemos observar un ejemplo de un archivo de
			configuración de self healing generado por ``Scenarios UI''.			
	
		\subsubsection{Una configuración de ``Self Healing'' subyacente}

			La idea básica de uso de ``Scenarios UI'' es que, en todo momento, exista una configuración de ``Self Healing''
			subyacente. Bien sea que el usuario la haya creado ``desde cero'' o bien, que el usuario haya abierto una
			configuración preexistente desde un archivo.

			\begin{figure}[h]
				\centering
					\includegraphics[scale=0.5]{images/scenariosUI_newORopen.png}
				\caption{Diálogo de creación o apertura de archivo}
			\end{figure}

			Ante cualquier acción del usuario de ``Scenarios UI'' dónde se guarden cambios hechos en la configuración activa, la
			aplicación \textbf{guardará automáticamente dichos cambios en el archivo subyacente}, garantizando así la
			persistencia de los cambios hechos por el usuario en casos especiales de pérdida de energía o fallas inesperadas en
			la computadora que se encuentra corriendo ``Scenarios UI''. Recordemos que, de estar el usuario editando el archivo
			de configuración que Arco Iris está utilizando en \emph{runtime}, cualquier cambio automáticamente guardado por
			``Scenarios UI'' será automáticamente detectado por ``Arco Iris'', lo cual dinamiza el comportamiento original
			presente en \emph{Rainbow}.
			
		\subsubsection{Auto refresco de tablas}

			Como veremos más adelante en detalle, en ``Scenarios UI'' se visualizan los componentes (i.e. escenarios, entornos,
			artifacts, etc.) existentes en el sistema con una tabla que sumariza sus propiedades más relevantes. En general,
			estas tablas se refrescarán automáticamente de acuerdo a los cambios hechos en los objetos subyacentes que componen
			la configuración de \emph{self healing}.

		\subsubsection{Ids ``inteligentes''}
			El identificador único de los objetos que componen un escenario de auto reparación (e.g. artifacts, entornos, etc.)
			es encarado en todos los casos de una única manera, tomemos el \emph{artifact} a modo de ejemplo: la aplicación
			considera los id's de los artifacts existentes en el sistema y al momento de crear un artifact nuevo, sugiere
			automáticamente un id no utilizado, de modo de garantizar la unicidad de dicho objeto cuando sea usado en ``Arco
			Iris''.
		
		\subsubsection{Constraints}
		\label{sec:scenariosUI_constraints}

			Tanto en el contexto de creación/edición de un entorno (al imponer restricciones sobre su ocurrencia) como al crear o
			editar el \emph{response measure} de un escenario, las llamadas ``restricciones'' (o \emph{constraints}) son una
			parte fundamental de la configuración requerida para que Arco Iris provea su funcionalidad adecuadamente.
			
			El componente visual asociado a una restricción fue diseñado para ser fácilmente extendido pero, sólo a fines del
			presente trabajo y con el objetivo de acotar la funcionalidad a los límites impuestos en los objetivos del mismo,
			sólo hemos implementado un sólo tipo de restricción: la restricción numérica relacional binaria (ver
			\ref{numericBinaryRelationalConstraint} para más detalle).
			
			\begin{figure}[h]
				\centering
					\includegraphics[scale=0.5]{images/scenariosUI_numericBinaryRelationalConstraint.png}
				\caption{Diálogo de creación o edición de una restricción numérica binaria relacional}
				\label{fig:numericBinaryRelationalConstraint}
			\end{figure}

	\subsection{Administración de Artifacts}
		Uno de los componentes relevantes a un escenario de auto reparación es el llamado \emph{Artifact}, el cual representa
		al componente de arquitectura que está involucrado en el escenario en cuestión.
		
		``Scenarios UI'' provee la funcionalidad de alta, baja y modificación (ABM) básica para administrar \emph{artifacts}
		junto con una solapa dentro de la pantalla principal de la aplicación para poder visualizar las propiedades más
		importantes de dichos objetos.

		\begin{figure}[ht]
			\centering
				\includegraphics[scale=0.5]{images/scenariosUI_artifact.png}
			\caption{Diálogo de creación o edición de un \emph{artifact}, con su solapa ABM en segundo plano}
		\end{figure}

	\subsection{Administración de Entornos}
		El ``Entorno'' es uno de los componentes más relevantes dentro de un escenario de auto reparación: representa la
		situación concreta (en tiempo de ejecución) dónde el escenario en cuestión va a aplicar.
		
		Al igual que para los \emph{artifacts}, ``Scenarios UI'' provee la funcionalidad de ABM para administrar escenarios
		junto con una solapa para visualizar sus propiedades más relevantes.

		\begin{figure}[ht]
			\centering
				\includegraphics[scale=0.5]{images/scenariosUI_environment.png}
			\caption{Diálogo de creación o edición de un entorno, con su solapa ABM en segundo plano}
		\end{figure}

		El cuadro de diálogo que muestra las propiedades de un entorno está diseñado para recoger dinámicamente todos los
		\emph{concerns} existentes en el sistema e inicialmente asignarle a cada uno un peso equidistribuído $P$
		determinado de la siguiente forma:
		\begin{equation}
			P = \frac{1}{K}
		\end{equation}
		dónde $K$ es la cantidad de concerns existentes en el sistema.
		
		Se observa también la funcionalidad de ABM para las condiciones que se deben cumplir para que el entorno se cumpla en
		\emph{runtime}. Aquí se reutiliza un componente genérico para restricciones, también utilizado en el diálogo de
		creación de un escenario (Ver figura \ref{fig:numericBinaryRelationalConstraint})

	\subsection{Administración de Escenarios}

		Finalmente, llegamos al concepto central del presente trabajo: el escenario de auto reparación. El mismo contiene los
		elementos ya vistos anteriormente junto con otros atributos que repasaremos a continuación. Por supuesto que existe,
		al igual que para los otros conceptos anteriormente vistos, una solapa dedicada para maneja las altas, bajas y
		modificaciones de escenarios.

		\begin{figure}[ht]
			\centering
				\includegraphics[scale=0.5]{images/scenariosUI_selfHealingScenario.png}
			\caption{Diálogo de creación o edición de un escenario, con su solapa ABM en segundo plano}
		\end{figure}
		
		En la figura anterior observamos que:
		\begin{itemize}
			\item Existe la posibilidad de marcar un escenario como habilitado o deshabilitado. Recordemos que Arco Iris
			únicamente considera escenarios habilitados.
			\item El combo box de \emph{Concerns} se llena con los Concerns existentes en el sistema al momento de cargarse el
			cuadro de diálogo.
			\item Se permite especificar que el estímulo correspondiente al escenario es ``cualquiera''.
			\item Se permite elegir artifacts, considerando los existentes en el sistema o creando ad-hoc uno nuevo.
			\item En el componente ``Response Measure'' se reutiliza el componente mencionado anteriormente en la sección
			\ref{sec:scenariosUI_constraints} para crear y editar constraints.
		\end{itemize}

		\subsubsection{Selección de Entornos}
			La selección de entornos merece un apartado especial debido a la presencia del pseudo-entorno denominado ``ANY'', el
			cual es automáticamente asignado al escenario si el usuario no elige explícitamente ningún entorno o en su defecto si
			decide explícitamente expresar su deseo de que el escenario aplique ``para cualquier entorno de ejecución''. A
			continuación, una breve descripción de dicho pseudo-entorno:

			\todo{TURCO: DEBERIAMOS PONER ESTA EXPLICACION EN LA SECCION ``ARCO IRIS''??}
			\paragraph{El entorno ``ANY''}

				Existe un entorno no mostrado en la solapa de Entornos (ya que no es editable) pero que posee una relevancia no
				menor: el (pseudo-)entorno ``ANY'' (cualquiera) es una suerte de comodín utilizado para denotar la siguiente
				semántica: ``El presente escenario aplica para cualquier condición de \emph{runtime} (i.e. para cualquier entorno de
				ejecución). Consecuentemente, en dicho entorno especial, la distribución de pesos es la que uno puede esperar: los
				pesos se encuentran equidistribuídos para no ``inclinar la balanza'' hacia ningún \emph{concern} en particular y por
				otro lado, el entorno no impone ninguna condición, con lo cual el mismo aplicará siempre en todos los casos,
				trivialmente.

		\subsubsection{Selección de Estrategias de Reparación}
		\label{sec:strategySelection}

			Una funcionalidad interesante de ``Scenarios UI'' es su capacidad para, en el contexto de la creación o edición de un
			escenario, poder elegir una estrategia de reparación directamente desde el archivo \emph{stitch}\todo{referencia?} en
			el cual se encuentra definida la misma. Primeramente, se elige el archivo que contiene las estrategias, para luego
			seleccionar la estrategia deseada, visualizando el código (en el lenguaje de scripting \emph{stitch}) de la misma.

			Notar que para el caso de las estrategias de reparación, y a diferencia del resto de los otros conceptos explicados
			hasta este momento, no es posible crear una estrategia ad-hoc, sino que se deben usar únicamente las ya existentes.

			\begin{figure}[ht]
				\centering
					\includegraphics[scale=0.5]{images/scenariosUI_select_repair_strategy_1.png}
				\caption{Diálogo de selección del archivo que contiene las estrategias}
			\end{figure}
		
			\begin{figure}[ht]
				\centering
					\includegraphics[scale=0.4]{images/scenariosUI_select_repair_strategy_2.png}
				\caption{Diálogo de selección de la estrategia de reparación}
			\end{figure}
			
			Al momento de especificar estrategias de reparación, es importante mencionar que la aplicación también permite
			especificar la siguiente semántica:

			``Considerar \textbf{todas} las estrategias de reparación disponibles en Arco Iris al momento de la ejecución''
			
			Lo anterior significa ni más ni menos que el usuario que configura ``Arco Iris'' vía ``Scenarios UI'', no impone un
			conjunto específico de estrategias de reparación a ser utilizadas sino que por lo contrario, permite que cualquier
			estrategia disponible sea considerada por ``Arco Iris'' para la reparación del escenario subyacente.

			\begin{figure}[ht]
				\centering
					\includegraphics[width=1.00\textwidth]{images/scenariosUI_select_repair_strategy_all_1.png}
				\caption{Elección de \textbf{todas} las estrategias de reparación disponibles}
			\end{figure}

			\begin{figure}[ht]
				\centering
					\includegraphics[width=1.00\textwidth]{images/scenariosUI_select_repair_strategy_all_2.png}
				\caption{\textbf{Todas} las estrategias de reparación disponibles seleccionadas}
			\end{figure}

	\subsection{Puntos de extensión}
	
		A continuación, enunciaremos algunos de los posibles puntos de extensión para únicamente para la
		herramienta ``Scenarios UI'' (para ver puntos de extensión para ``Arco Iris'', remitirse a la sección
		\ref{sec:puntos_extension}):
		\begin{itemize}
			\item Los artifacts podrían seleccionarse del archivo .acme que contiene la descripción de la arquitectura del
			sistema a adaptar, en lugar de tener que escribir el usuario el `system name'' y ``property name'' del componente en
			cuestión.
			\item lo mismo podría hacerse con los estímulos, ya que ellos serán normalmente la etiqueta de un puerto, en el
			contexto del diagrama de C\&C (componentes y conectores)
			\item se podrían soportar nuevos tipos de \emph{constraint}, además de la ya mencionada ``numérica binaria
			relacional''.
		\end{itemize}